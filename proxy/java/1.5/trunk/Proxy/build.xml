<?xml version="1.0" ?>
<project default="createwar" basedir=".">

	<property name="projet.src.dir" value="src"/>
	<property name="projet.conf.dir" value="web"/>
	<property name="projet.work.dir" value="work"/>
	<property name="projet.out.dir" value="out"/>
	<property name="projet.lib.dir" value="lib"/>
	
	<path id="projet.classpath">
		<fileset dir="${projet.lib.dir}">
			<include name="*.jar"/>
		</fileset>
	</path>
	

	<target name="createwar" depends="create-structure,copy-resources,compilation,compression,deleteResources,war" description="Main target">
	</target>

	
	<target name="create-structure">
		<echo>Creating the working directory structure</echo>
		<mkdir dir="${projet.out.dir}" />
		<mkdir dir="${projet.work.dir}" />
		<mkdir dir="${projet.work.dir}/META-INF" />
		<mkdir dir="${projet.work.dir}/WEB-INF" />
		<mkdir dir="${projet.work.dir}/WEB-INF/conf" />
		<mkdir dir="${projet.work.dir}/WEB-INF/spring" />
		<mkdir dir="${projet.work.dir}/WEB-INF/classes" />
		<mkdir dir="${projet.work.dir}/WEB-INF/lib" />
	</target>

	<target name="copy-resources">
		<copy todir="${projet.work.dir}/META-INF/" >
			<fileset dir="${projet.conf.dir}/META-INF" >
				<include name="context.xml"/>
			</fileset>
		</copy>
		<copy todir="${projet.work.dir}/WEB-INF/" >
			<fileset dir="${projet.conf.dir}/WEB-INF" >
				<include name="web.xml"/>
			</fileset>
		</copy>
		
		<echo>Copy the resources into the working directory</echo>
		<copy todir="${projet.work.dir}/WEB-INF/lib" >
			<fileset dir="${projet.lib.dir}" >
				<include name="**/*.jar"/>
				<include name="**/*.zip"/>
				<exclude name="**/jetty*"/>
				<exclude name="**/servlet-api-6.0.18.jar"/>
				<exclude name="**/jsp-api-6.0.18.jar"/>
			</fileset>
		</copy>

		<copy todir="${projet.work.dir}/WEB-INF/conf/" >
			<fileset dir="${projet.conf.dir}/WEB-INF/conf" >
				<include name="config.xml"/>
				<include name="NewPolicy.xml"/>
			</fileset>
		</copy>

		<copy todir="${projet.work.dir}/WEB-INF/spring/" >
			<fileset dir="${projet.conf.dir}/WEB-INF/spring" >
				<include name="app-config.xml"/>
				<include name="security-config.xml"/>
			</fileset>
		</copy>
	</target>
	
	<target name="compilation" description="Compilation" >
		<javac debug="on" srcdir="${projet.src.dir}" destdir="${projet.work.dir}/WEB-INF/classes" >
			<classpath refid="projet.classpath"/>
		</javac>
	</target>

	<target name="compression" description="Compression" >
		<jar jarfile="${projet.work.dir}/WEB-INF/lib/easysdi.jar" basedir="${projet.work.dir}/WEB-INF/classes"  />
	</target>
	
	<target name="deleteResources" description="generate the war" >
		<delete includeEmptyDirs="true">
			<fileset dir="${projet.work.dir}/WEB-INF/classes" />
		</delete>
	</target>
	
	<target name="war" description="generate the war" >
		<tstamp/>
		<echo>Building the war file</echo>
		<war warfile="${projet.out.dir}/proxy.${DSTAMP}.${TSTAMP}.war" basedir="${projet.work.dir}" />
	</target>

</project>