
Ext.namespace("EasySDI_Map");Ext.ux.collapsedPanelTitlePlugin=function(){this.init=function(p){if(p.collapsible){var r=p.region;if((r=='north')||(r=='south')){p.on('render',function(){var ct=p.ownerCt;ct.on('afterlayout',function(){if(ct.layout[r].collapsedEl){p.collapsedTitleEl=ct.layout[r].collapsedEl.createChild({tag:'span',cls:'x-panel-collapsed-text',html:p.title});p.setTitle=Ext.Panel.prototype.setTitle.createSequence(function(t){p.collapsedTitleEl.dom.innerHTML=t;});}},false,{single:true});p.on('collapse',function(){if(ct.layout[r].collapsedEl&&!p.collapsedTitleEl){p.collapsedTitleEl=ct.layout[r].collapsedEl.createChild({tag:'span',cls:'x-panel-collapsed-text',html:p.title});p.setTitle=Ext.Panel.prototype.setTitle.createSequence(function(t){p.collapsedTitleEl.dom.innerHTML=t;});}},false,{single:true});});}}};};EasySDI_Map.RwgLayout=Ext.extend(EasySDI_Map.LayoutBase,{constructor:function(config){Ext.QuickTips.init();this._initPanels();config.layout="border";var treePanelWidth=(componentParams.treePanelWidth!=undefined)?parseInt(componentParams.treePanelWidth):300;var layersAndPrecisions;if(componentParams.authorisedTo.DATA_PRECISION&&componentDisplayOption.DataPrecisionEnable){layersAndPrecisions=new Ext.Panel({region:"west",title:EasySDI_Map.lang.getLocal("02000000"),border:true,collapsible:true,width:treePanelWidth,items:new Ext.TabPanel({activeTab:0,items:[this.layerPanel,this.dataPrecisionPanel]})});}else{layersAndPrecisions=this.layerPanel;}
config.items=[this.searchPanel,layersAndPrecisions,this.legendOrFilterPanel,this.gridPanel,this.mapPanel];EasySDI_Map.RwgLayout.superclass.constructor.apply(this,arguments);this.mapPanel._onAnnotationStyleSelect(null,true);if(componentDisplayOption.zoomToScaleFieldEnable){var keyMap=new Ext.KeyMap(this.mapPanel.zoomToScaleField.id,[{key:Ext.EventObject.ENTER,fn:function(){this.mapPanel._zoomToScale(this.mapPanel.zoomToScaleField.getValue());},scope:this}]);}},_initPanels:function(){this.mapPanel=new EasySDI_Map.MapPanel({region:"center",overviewWidth:120,overviewHeight:170});this.searchPanel=new EasySDI_Map[extensionClasses.SearchPanelClassName]({region:"north",border:false});this.layerTree=new EasySDI_Map.LayerTree({map:this.mapPanel});var precisionTree=new EasySDI_Map.PrecisionTree();this.layerPanel=new EasySDI_Map.LayerPanel({title:EasySDI_Map.lang.getLocal("02000002"),tree:this.layerTree,region:componentParams.authorisedTo.PRECISE_DATA&&componentDisplayOption.DataPrecisionEnable?null:"west"});this.dataPrecisionPanel=new EasySDI_Map.DataPrecisionPanel({title:EasySDI_Map.lang.getLocal("02000001"),tree:precisionTree});this.legendPanel=new EasySDI_Map.LegendPanel({id:'legend',map:this.mapPanel.map,autoScroll:true,layerTree:this.layerTree});var legendOrFilterPanelWidth=(componentParams.legendOrFilterPanelWidth!=undefined)?parseInt(componentParams.legendOrFilterPanelWidth):300;this.legendOrFilterPanel=new Ext.Panel({region:"east",layout:"card",width:legendOrFilterPanelWidth,activeItem:0,collapsible:true,title:EasySDI_Map.lang.getLocal("02000003"),split:true,items:[this.legendPanel]});this.gridPanel=new EasySDI_Map.GridPanel({title:EasySDI_Map.lang.getLocal("02000004"),plugins:new Ext.ux.collapsedPanelTitlePlugin(),region:"south",height:260,collapsible:true,collapsed:true});this.searchPanel.registerTrigger('showFilterPanel',this.showFilterPanel.createDelegate(this));},showFilterPanel:function(innerSearchBar){if(!this.filterPanel){this.filterPanel=new EasySDI_Map[extensionClasses.FilterPanelClassName]({mapPanel:this.mapPanel,innerSearchBar:innerSearchBar});this.legendOrFilterPanel.add(this.filterPanel);this.searchPanel.registerTrigger('filterPanel.setMode',this.filterPanel.SetMode.createDelegate(this.filterPanel));this.searchPanel.registerTrigger('filterPanel.updateFilter',this.filterPanel.updateFilter.createDelegate(this.filterPanel));this.filterPanel.registerTrigger('doSearch',this.searchManager.doSearch.createDelegate(this.searchManager));this.filterPanel.registerTrigger('hideFilterPanel',this.hideFilterPanel.createDelegate(this));}else{this.filterPanel.innerSearchBar=innerSearchBar;if(this.filterPanel.placeTab){this.filterPanel.placeTab.doShow();}}
this.legendOrFilterPanel.getLayout().setActiveItem(1);this.legendOrFilterPanel.setWidth(490);this.legendOrFilterPanel.setTitle(EasySDI_Map.lang.getLocal("02000005"));this.doLayout();},hideFilterPanel:function(){this.legendOrFilterPanel.getLayout().setActiveItem(0);this.legendOrFilterPanel.setWidth(300);this.legendOrFilterPanel.setTitle(EasySDI_Map.lang.getLocal("02000003"));this.doLayout();}});