<?xml version="1.0" encoding="UTF-8"?>
<!--
 *   Copyright 2006 - 2009 ETH Zurich 
 *
 *   Licensed under the Apache License, Version 2.0 (the "License");
 *   you may not use this file except in compliance with the License.
 *   You may obtain a copy of the License at
 *
 *       http://www.apache.org/licenses/LICENSE-2.0
 *
 *   Unless required by applicable law or agreed to in writing, software
 *   distributed under the License is distributed on an "AS IS" BASIS,
 *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *   See the License for the specific language governing permissions and
 *   limitations under the License.
 -->


<project name="MXQuery" default="jar" basedir=".">
	
	<property name="officialName" value="MXQuery"></property>
	<property name="version" value="0.6.0"></property>
	<property name="year" value="2006-2009"></property>
	<property name="copyright" value="ETH Zurich"></property>
	
	
    <property name="debug" value="on"/>
    <property name="optimize" value="on"/>
	<property name="src.version" value="1.3"/>
	
	<property name="root.dir" value="."/>
    <property name="src.dir" value="${root.dir}/src"/>
	<property name="resources.dir" value="${root.dir}/lib"/>
	<property name="build.dir" value="${root.dir}/build"/>
	<property name="dist.dir" value="${root.dir}/dist"/>

	<property name="customtmp.dir" value="${root.dir}/customtmp"/>
	<property name="midptmp.dir" value="${customtmp.dir}"/>
	
	<property name="tmpfunc.dir" value="${customtmp.dir}/ch/ethz/mxquery/functions"/>
	<property name="srcfunc.dir" value="${src.dir}/ch/ethz/mxquery/functions"/>
	
	<property name="noparsertmp.dir" value="${root.dir}/noparsertmp"/>
	
	<property name="modules.dir" value="${root.dir}/mod2export"/>
	<property name="war.dir" value ="${build.dir}/war"/>
	<property name="webinf.dir" value="${war.dir}/WEB-INF"/>
	<property name="weblib.dir" value="${webinf.dir}/lib"/>
	<property name="webclasses.dir" value="${webinf.dir}/classes"/>
	<property name="servlet.dir" value="${webclasses.dir}/ch/ethz/mxquery/query/webservice"/>
	<property name="utilservlet.dir" value="${webclasses.dir}/ch/ethz/mxquery/util"/>
	
	<import file="generate_funcgallery.xml"/>
	
	<condition property="wtk.home" value="C:\\WTK2.5.2_01">
		<os family="windows"/>
	</condition>
	<condition property="wtk.home" value="/usr/local/WTK2.5.2">
		<os family="unix"/>
	</condition>


	<property name="wtk.cldc.version" value="1.0"/>
	<property name="wtk.midp.version" value="2.0"/>
	<property name="midpsrc.dir" value="${root.dir}/midp_src"/>
	<property name="altsrc.dir" value="${root.dir}/altsrc"/>

	<path id="project.class.path">
	<pathelement location="${resources.dir}/xml-apis.jar" />
       <fileset dir="${resources.dir}">
	       <include name="*.jar"/>
	   </fileset>
	<pathelement path="${java.class.path}"/>
	</path>
	
	<path id="midlet.class.path">
       <pathelement location="${build.dir}"/>
       <fileset dir="${resources.dir}">
       	   <include name="kxml2-min-2.3.0.jar"/>
    	   <include name="xmlpull_1_1_3_4c.jar"/>       	 
	   </fileset>
	</path>
	
	<taskdef resource="antenna.properties" classpath="${resources.dir}/antenna-bin-0.9.14.jar"/>
	
    <target name="clean">
    	<echo message="Cleaning directories..."/>
        <delete>
            <fileset dir="${build.dir}/">
                <include name="**/*"/>
            </fileset>
            <fileset dir="${customtmp.dir}/">
                <include name="**/*"/>
            </fileset>
        </delete>
    	
		<mkdir dir="${build.dir}"/>
		<mkdir dir="${dist.dir}"/>		
    	<mkdir dir="${customtmp.dir}"/>
    </target>
        	
    <target name="compile" depends="clean">
		<echo message="Compiling..."/>
		
		<depend srcdir="${src.dir}"
		        destdir="${build.dir}"
		        cache="depcache"
		        closure="yes"
		/>

        <javac source="${src.version}"
               srcdir="${src.dir}"
               destdir="${build.dir}"
        		target="1.4"
               classpathref="project.class.path"
               debug="${debug}"
               optimize="${optimize}"
               extdirs=""
        />
    </target>

    <target name="compile-15" depends="clean">
    	<echo message="Merging source trees"/>
    	<delete>
        <fileset dir="${customtmp.dir}/">
            <include name="**/*"/>
        </fileset>
	</delete>
 	<copy todir="${customtmp.dir}"><fileset dir="${src.dir}"/></copy>


	<delete file="${customtmp.dir}/ch/ethz/mxquery/functions/fn/NormalizeUnicode.java" />

		<depend srcdir="${customtmp.dir}"
		        destdir="${build.dir}"
		        cache="depcache"
		        closure="yes"
		/>

        <javac source="${src.version}"
               srcdir="${customtmp.dir}"
               destdir="${build.dir}"
        		target="1.4"
               classpathref="project.class.path"
               debug="${debug}"
               optimize="${optimize}"
               extdirs=""
        />
    </target>	


    <target name="compile-14" depends="clean">
    	<echo message="Merging source trees"/>
    	<delete>
        <fileset dir="${customtmp.dir}/">
            <include name="**/*"/>
        </fileset>
	</delete>
 	<copy todir="${customtmp.dir}"><fileset dir="${src.dir}"/></copy>

	<delete>
		<fileset dir="${customtmp.dir}/ch/ethz/mxquery/sms/MMimpl/" id="id">
			<include name="*.java"/>
			   <exclude name="TokenBufferStore.java"/>
		</fileset>
		<fileset dir="${customtmp.dir}/ch/ethz/mxquery/parallel" id="id">
			<include name="*.java"/>
		</fileset>
	</delete>

	<delete file="${customtmp.dir}/ch/ethz/mxquery/sms/activeStore/ReadThreadUpdate.java" />
	<delete file="${customtmp.dir}/ch/ethz/mxquery/sms/activeStore/ReadDataThread.java" />

	<delete file="${customtmp.dir}/ch/ethz/mxquery/functions/fn/NormalizeUnicode.java" />

	<delete file="${customtmp.dir}/ch/ethz/mxquery/iterators/PFFLWORIterator.java" />
	<delete file="${customtmp.dir}/ch/ethz/mxquery/iterators/forseq/ForseqWindowEarlyBinding.java" />
	<delete file="${customtmp.dir}/ch/ethz/mxquery/iterators/forseq/ForseqWindowEarlyBindingParallel.java" />
	<delete file="${customtmp.dir}/ch/ethz/mxquery/query/parser/J56Parser.java" />
	<delete file="${customtmp.dir}/ch/ethz/mxquery/extensionsModules/util/Uuid.java" />

	<delete file="${customtmp.dir}/examples/StreamExample.java" />

	<copy file="${midpsrc.dir}/ch/ethz/mxquery/functions/fn/String_Length.java" todir="${customtmp.dir}/ch/ethz/mxquery/functions/fn/" overwrite="yes"/>
	<copy file="${midpsrc.dir}/ch/ethz/mxquery/functions/fn/SubString.java" todir="${customtmp.dir}/ch/ethz/mxquery/functions/fn/" overwrite="yes"/>
	<copy file="${midpsrc.dir}/ch/ethz/mxquery/functions/fn/StringToCodepoints.java" todir="${customtmp.dir}/ch/ethz/mxquery/functions/fn/" overwrite="yes"/>
	<copy file="${midpsrc.dir}/ch/ethz/mxquery/functions/fn/Translate.java" todir="${customtmp.dir}/ch/ethz/mxquery/functions/fn/" overwrite="yes" />
	<copy file="${midpsrc.dir}/ch/ethz/mxquery/sms/MMimpl/TokenBufferStore.java" todir="${customtmp.dir}/ch/ethz/mxquery/sms/MMimpl/" overwrite="yes" />
	<copy file="${midpsrc.dir}/ch/ethz/mxquery/sms/StoreFactory.java" todir="${customtmp.dir}/ch/ethz/mxquery/sms/" overwrite="yes" /> 

	<copy file="${midpsrc.dir}/ch/ethz/mxquery/bindings/WindowBuffer.java" todir="${customtmp.dir}/ch/ethz/mxquery/bindings/" overwrite="yes" />
	<copy file="${midpsrc.dir}/ch/ethz/mxquery/util/PlatformDependentUtils.java" todir="${customtmp.dir}/ch/ethz/mxquery/util" overwrite="yes" />
	<copy file="${altsrc.dir}/ch/ethz/mxquery/datamodel/MXQueryFloat.java" todir="${customtmp.dir}/ch/ethz/mxquery/datamodel" overwrite="yes" />
	<copy file="${altsrc.dir}/ch/ethz/mxquery/datamodel/MXQueryBigDecimal.java" todir="${customtmp.dir}/ch/ethz/mxquery/datamodel" overwrite="yes" />
	<copy file="${altsrc.dir}/ch/ethz/mxquery/query/impl/CompilerImpl.java" todir="${customtmp.dir}/ch/ethz/mxquery/query/impl" overwrite="yes" />
    <copy file="${altsrc.dir}/ch/ethz/mxquery/xdmio/xmlAdapters/NonValidatingDOMAdapter.java" todir="${customtmp.dir}/ch/ethz/mxquery/xdmio/xmlAdapters/" overwrite="yes" />


		<depend srcdir="${customtmp.dir}"
		        destdir="${build.dir}"
		        cache="depcache"
		        closure="yes"
		/>

        <javac source="${src.version}"
               srcdir="${customtmp.dir}"
               destdir="${build.dir}"
        		target="1.4"
               classpathref="project.class.path"
               debug="${debug}"
               optimize="${optimize}"
		includeAntRuntime="false"
               extdirs=""
        />
    </target>	
	
	<target name="jar" depends="compile">
		<echo message="Creating jar archive..."/>
		<unjar src="${resources.dir}/kxml2-min-2.3.0.jar" dest="${build.dir}"></unjar>
		<unjar src="${resources.dir}/xmlpull_1_1_3_4c.jar" dest="${build.dir}"></unjar>
		<unjar src="${resources.dir}/xercesImpl.jar" dest="${build.dir}"></unjar>
		<unjar src="${resources.dir}/tagsoup-1.2.jar" dest="${build.dir}"></unjar>
		<unjar src="${resources.dir}/xqjapi.jar" dest="${build.dir}"></unjar>
		<unjar src="${resources.dir}/commons-cli-1.2.jar" dest="${build.dir}"></unjar>
		<jar jarfile="${dist.dir}/mxquery.jar">
			<fileset dir="${build.dir}" excludes="examples/**/*.*"/>
			<fileset dir="${src.dir}" includes="ch/**/*.xq"/>
			<fileset dir="${src.dir}" includes="ch/**/*.xml"/>			
			<fileset dir="${src.dir}" includes="ch/**/*.txt"/>
			<fileset dir="${src.dir}" includes="**/*.servlet"/>
			<fileset dir="${src.dir}" includes="ch/**/*.txt"/>

		    <manifest>
		    	<attribute name="Built-By" value="MXQuery Team at ETH Zurich (info@mxquery.org)"/>
		    	<attribute name="Main-Class" value="ch.ethz.mxquery.cmdline.MXQuery"/>
		    </manifest>
		</jar>
	</target>


	<target name="jar-15" depends="compile-15">
		<echo message="Creating jar archive..."/>
		<unjar src="${resources.dir}/kxml2-min-2.3.0.jar" dest="${build.dir}"></unjar>
		<unjar src="${resources.dir}/xmlpull_1_1_3_4c.jar" dest="${build.dir}"></unjar>
		<unjar src="${resources.dir}/jax-1_1-fr-qname-class.jar" dest="${build.dir}"></unjar>
		 <unjar src="${resources.dir}/xercesImpl.jar" dest="${build.dir}"></unjar>
		<unjar src="${resources.dir}/jsr173_1.0_api.jar" dest="${build.dir}"></unjar>
		<unjar src="${resources.dir}/tagsoup-1.2.jar" dest="${build.dir}"></unjar>
		<unjar src="${resources.dir}/xqjapi.jar" dest="${build.dir}"></unjar>
		<unjar src="${resources.dir}/commons-cli-1.2.jar" dest="${build.dir}"></unjar>
		<jar jarfile="${dist.dir}/mxquery-15.jar">
			<fileset dir="${build.dir}" excludes="examples/**/*.*"/>
			<fileset dir="${src.dir}" includes="ch/**/*.xq"/>
			<fileset dir="${src.dir}" includes="ch/**/*.xml"/>			
			<fileset dir="${src.dir}" includes="ch/**/*.txt"/>
		
		    <manifest>
		    	<attribute name="Built-By" value="MXQuery Team at ETH Zurich (info@mxquery.org)"/>
		    	<attribute name="Main-Class" value="ch.ethz.mxquery.cmdline.MXQuery"/>
		    </manifest>
			
			
		</jar>
	</target>	


	<target name="jar-14" depends="compile-14">
		<echo message="Creating jar archive..."/>
		<unjar src="${resources.dir}/kxml2-min-2.3.0.jar" dest="${build.dir}"></unjar>
		<unjar src="${resources.dir}/xml-apis.jar" dest="${build.dir}"></unjar>
		<unjar src="${resources.dir}/xercesImpl.jar" dest="${build.dir}"></unjar>
		<unjar src="${resources.dir}/xmlpull_1_1_3_4c.jar" dest="${build.dir}"></unjar>
		<unjar src="${resources.dir}/jax-1_1-fr-qname-class.jar" dest="${build.dir}"></unjar>
		<unjar src="${resources.dir}/jsr173_1.0_api.jar" dest="${build.dir}"></unjar>
		<unjar src="${resources.dir}/tagsoup-1.2.jar" dest="${build.dir}"></unjar>
		<unjar src="${resources.dir}/xqjapi.jar" dest="${build.dir}"></unjar>
		<unjar src="${resources.dir}/commons-cli-1.2.jar" dest="${build.dir}"></unjar>
		<jar jarfile="${dist.dir}/mxquery-14.jar">
			<fileset dir="${build.dir}" excludes="examples/**/*.*"/>
			<fileset dir="${src.dir}" includes="ch/**/*.xq"/>
			<fileset dir="${src.dir}" includes="ch/**/*.xml"/>			
			<fileset dir="${src.dir}" includes="ch/**/*.txt"/>
		    <manifest>
		    	<attribute name="Built-By" value="MXQuery Team at ETH Zurich (info@mxquery.org)"/>
		    	<attribute name="Main-Class" value="ch.ethz.mxquery.cmdline.MXQuery"/>
		    </manifest>
		</jar>
	</target>	
	
	<target name="war" depends="jar-15">
		<echo message="Creating the war ... "/>
		<mkdir dir="${war.dir}"/>
        <delete>
            <fileset dir="${war.dir}/">
                <include name="**/*"/>
            </fileset>        	
        </delete>
		<mkdir dir="${webinf.dir}"/>
		<mkdir dir="${weblib.dir}"/>
		<mkdir dir="${webclasses.dir}"/>
		<mkdir dir="${servlet.dir}}"/>
		<mkdir dir="${utilservlet.dir}}"/>		
		<copy file="${build.dir}/ch/ethz/mxquery/query/webservice/MultipleXQueryServer.class" todir="${servlet.dir}"/>
		<copy file="${build.dir}/ch/ethz/mxquery/query/webservice/SingleXQueryServer.class" todir="${servlet.dir}"/>
		<copy file="${build.dir}/ch/ethz/mxquery/util/MultipleSchemaExposer.class" todir="${utilservlet.dir}"/>
		<copy file="${build.dir}/ch/ethz/mxquery/util/SingleSchemaExposer.class" todir="${utilservlet.dir}"/>
		<copy file="${src.dir}/ch/ethz/mxquery/query/webservice/web.xml" todir="${webinf.dir}"/>
		<copy file="${src.dir}/ch/ethz/mxquery/query/webservice/index.html" todir="${war.dir}"/>
		<copy file="${dist.dir}/mxquery-15.jar" todir="${weblib.dir}"/>
		<copy todir="${war.dir}"><fileset dir="${modules.dir}"/></copy>
		<jar jarfile="${dist.dir}/MXQuery.war">
			<fileset dir="${war.dir}"  includes="**/*.*"/>								
		    <manifest>
		    	<attribute name="Built-By" value="MXQuery Team at ETH Zurich (info@mxquery.org)"/>		    	
		    </manifest>
		</jar>			
	</target>
	
	<target name="midp_prepare" depends="clean">
    	<echo message="Merging source trees"/>
    	<delete>
        <fileset dir="${midptmp.dir}/">
            <include name="**/*"/>
        </fileset>
	    </delete>
 		<copy todir="${midptmp.dir}"><fileset dir="${src.dir}"/></copy>
 		<copy todir="${midptmp.dir}" overwrite="yes"><fileset dir="${midpsrc.dir}"/></copy>
    	<echo message="Removing unsupported classes"/>
    	
       	<delete dir="${midptmp.dir}/ch/ethz/mxquery/parallel/"/>
		<delete dir="${midptmp.dir}/javax/"/>
   		<delete dir="${midptmp.dir}/ch/ethz/mxquery/xqj/"/>
        	<delete dir="${midptmp.dir}/ch/ethz/mxquery/opt/expr"/>
        	<delete dir="${midptmp.dir}/ch/ethz/mxquery/opt/index"/>
     		<delete dir="${midptmp.dir}/ch/ethz/mxquery/query/optimizer"/>
		
			<delete>
				<fileset dir="${midptmp.dir}/ch/ethz/mxquery/sms/MMimpl/">
    				<include name="*.java"/>
 				   <exclude name="TokenBufferStore.java"/>
				</fileset>
			</delete>
   			<delete>
				<fileset dir="${midptmp.dir}/examples">
					<include name="*.java"/>
				</fileset>
			</delete>
			<delete>
			<fileset dir="${midptmp.dir}/ch/ethz/mxquery/cmdline">
				<include name="*.java"/>
			</fileset>
			</delete>

			<delete>
				<fileset dir="${midptmp.dir}/ch/ethz/mxquery/extensionsModules" id="id">
				<include name="**/*.java"/>
				   <exclude name="ExtensionModulesConfig.java"/>
					<exclude name="zorbaRest/HttpIO.java"/>
				</fileset>
			</delete>
			<delete file="${midptmp.dir}/ch/ethz/mxquery/sms/activeStore/ReadThreadUpdate.java" />
			<delete file="${midptmp.dir}/ch/ethz/mxquery/sms/activeStore/ReadDataThread.java" />
		    <delete file="${midptmp.dir}/ch/ethz/mxquery/sms/interfaces/IndexInterface.java" />
			<delete file="${midptmp.dir}/ch/ethz/mxquery/sms/interfaces/IndexRead.java" />
			<delete file="${midptmp.dir}/ch/ethz/mxquery/sms/interfaces/IndexUpdate.java" />
			<delete file="${midptmp.dir}/ch/ethz/mxquery/sms/interfaces/RandomUpdate.java" />
	       	<delete file="${midptmp.dir}/ch/ethz/mxquery/iterators/GroupByIndexIterator.java"/>
	    	<delete file="${midptmp.dir}/ch/ethz/mxquery/iterators/DirectXMLIterator.java"/>
		    <delete file="${midptmp.dir}/ch/ethz/mxquery/iterators/PFFLWORIterator.java"/>
	    	<delete file="${midptmp.dir}/ch/ethz/mxquery/iterators/CommandLineInIterator.java"/>
        	<delete file="${midptmp.dir}/ch/ethz/mxquery/iterators/forseq/ForseqWindowIndexIterator.java"/>
			<delete file="${midptmp.dir}/ch/ethz/mxquery/iterators/forseq/ForseqWindowEarlyBinding.java"/>
			<delete file="${midptmp.dir}/ch/ethz/mxquery/iterators/forseq/ForseqWindowEarlyBindingParallel.java"/>
	    	<delete file="${midptmp.dir}/ch/ethz/mxquery/util/UnicodeInputStream.java"/>
			<delete file="${midptmp.dir}/ch/ethz/mxquery/util/UnicodeReader.java"/>
	    	<delete file="${midptmp.dir}/ch/ethz/mxquery/functions/mxq/DirectXMLWrapperIterator.java"/>
			<delete file="${midptmp.dir}/ch/ethz/mxquery/functions/mxq/Collection.java"/>
	       	<delete file="${midptmp.dir}/ch/ethz/mxquery/functions/mxq/CommandLineInIterator.java"/>
			<delete file="${midptmp.dir}/ch/ethz/mxquery/functions/mxq/SubFiles.java"/>
			<delete file="${midptmp.dir}/ch/ethz/mxquery/functions/mxq/SubFiles2.java"/>
		    <delete file="${midptmp.dir}/ch/ethz/mxquery/functions/mxq/Eratosthenes.java"></delete>
		   	<delete file="${midptmp.dir}/ch/ethz/mxquery/functions/fn/Floor.java"/>
		   	<delete file="${midptmp.dir}/ch/ethz/mxquery/functions/fn/Ceiling.java"/>
		   	<delete file="${midptmp.dir}/ch/ethz/mxquery/functions/fn/Abs.java"/>
		   	<delete file="${midptmp.dir}/ch/ethz/mxquery/functions/fn/Round.java"/>
			<delete file="${midptmp.dir}/ch/ethz/mxquery/functions/fn/Put.java"/>
		   	<delete file="${midptmp.dir}/ch/ethz/mxquery/functions/fn/Matches.java"/>
	   	    <delete file="${midptmp.dir}/ch/ethz/mxquery/functions/fn/EncodeForURI.java"/>
	        <delete file="${midptmp.dir}/ch/ethz/mxquery/functions/fn/IRItoURI.java"/>
	   		<delete file="${midptmp.dir}/ch/ethz/mxquery/functions/fn/DocAvailable.java"/>
	   		<delete file="${midptmp.dir}/ch/ethz/mxquery/functions/fn/NormalizeUnicode.java"/>	
			<delete file="${midptmp.dir}/ch/ethz/mxquery/model/ws/MultiPartFormOutputStream.java"/>
			<delete file="${midptmp.dir}/ch/ethz/mxquery/query/parser/SchemaParser.java"/>
			<delete file="${midptmp.dir}/ch/ethz/mxquery/query/parser/SEParser.java"/>
			<delete file="${midptmp.dir}/ch/ethz/mxquery/query/parser/J56Parser.java"/>
			<delete file="${midptmp.dir}/ch/ethz/mxquery/iterators/ValidateIterator.java"/>
			<delete file="${midptmp.dir}/ch/ethz/mxquery/xdmio/xmlAdapters/ValidatedSaxImportAdapter.java"/>
			<delete file="${midptmp.dir}/ch/ethz/mxquery/xdmio/xmlAdapters/Token2StaxAdapter.java"/>
			<delete file="${midptmp.dir}/ch/ethz/mxquery/xdmio/xmlAdapters/NonSchemaValidatingSaxImportAdapter.java"/>
			<delete file="${midptmp.dir}/ch/ethz/mxquery/xdmio/xmlAdapters/NonValidatingDOMAdapter.java"/>
			<delete file="${midptmp.dir}/ch/ethz/mxquery/xdmio/xmlAdapters/NonValidatingStaxAdapter.java"/>
			<delete file="${midptmp.dir}/ch/ethz/mxquery/query/webservice/MultipleXQueryServer.java"/>
			<delete file="${midptmp.dir}/ch/ethz/mxquery/query/webservice/SingleXQueryServer.java"/>
			<delete file="${midptmp.dir}/ch/ethz/mxquery/util/MultipleSchemaExposer.java"/>
			<delete file="${midptmp.dir}/ch/ethz/mxquery/util/SingleSchemaExposer.java"/>
	</target>
    <target name="midp_compile_wtk" depends="midp_prepare">
         	    	
		<echo message="Compiling..."/>
		
		<depend srcdir="${midptmp.dir}"
		        destdir="${build.dir}"
		        cache="depcache"
		        closure="yes"
		/>
    	<wtkbuild source="${src.version}"
    	    	               srcdir="${midptmp.dir}"
    	    	               destdir="${build.dir}"
					    		classpathref="midlet.class.path"
    	    	               debug="${debug}"
    	    	               optimize="${optimize}"
    	    	               extdirs=""
    						   preverify="false"
    	    	        /> 
    </target>

	<target name="midp_wtk" depends="midp_compile_wtk">
		<echo message="Creating midp jar archive..."/>
		<unjar src="${resources.dir}/kxml2-min-2.3.0.jar" dest="${build.dir}"></unjar>
		<unjar src="${resources.dir}/xmlpull_1_1_3_4c.jar" dest="${build.dir}"></unjar>
	    <wtkjad jarfile="${dist.dir}/mxquery_midp.jar" 
	    	jadfile="${dist.dir}/mxquery_midp.jad"
	                name="MXQuery"
	                vendor="MXQuery Team at ETH Zurich"
	                version="${version}">
	            <midlet name="MXQuery" class="ch.ethz.mxquery.mobile.MIDP"/>
				<attribute name="MIDlet-Permissions-Opt" value="javax.microedition.io.PushRegistry, javax.microedition.io.Connector.http, javax.microedition.io.Connector.socket, javax.microedition.io.Connector.https, javax.microedition.io.Connector.ssl, javax.microedition.io.Connector.datagram, javax.microedition.io.Connector.serversocket, javax.microedition.io.Connector.datagramreceiver, javax.microedition.io.Connector.comm"/>
	        </wtkjad>
		<wtkpackage jarfile="${dist.dir}/mxquery_midp.jar" 
			jadfile="${dist.dir}/mxquery_midp.jad"
			preverify="false">
			<fileset dir="${build.dir}" includes="**/*.*"/>
			<fileset dir="${midptmp.dir}" includes="**/*.xq"/>
			<fileset dir="${midptmp.dir}" includes="**/*.xml"/>			
		</wtkpackage>

		<wtkpreverify jarfile="${dist.dir}/mxquery_midp.jar" 
			jadfile="${dist.dir}/mxquery_midp.jad"/>
	</target>

	<target name="generate_custom_ant">
		<java jar="${dist.dir}/mxquery.jar" fork="true">
			<arg value="${srcfunc.dir}/GenerateAnt.xq"/>
			<arg value="-outputfile"/>
			<arg value="${root.dir}/generate_funcgallery.xml"/>
		</java>	
	</target>

	<target name="custom_compile" depends="clean, compile_functions">
	
		<echo message="Compiling..."/>
		
		<depend srcdir="${customtmp.dir}"
		        destdir="${build.dir}"
		        cache="depcache"
		        closure="yes"
		/>

 	  	<javac source="${src.version}"
               srcdir="${customtmp.dir}"
               destdir="${build.dir}"
               classpathref="project.class.path"
    	       debug="${debug}"
    	       optimize="${optimize}"
    	       extdirs=""
    	/>		
	</target>
		
	<target name="custom_jar" depends="custom_compile">
		<echo message="Creating customized jar archive..."/>
		<unjar src="${resources.dir}/kxml2-min-2.3.0.jar" dest="${build.dir}"></unjar>
		<unjar src="${resources.dir}/xmlpull_1_1_3_4c.jar" dest="${build.dir}"></unjar>
		<jar jarfile="${dist.dir}/mxquery_custom.jar">
		
			<fileset dir="${build.dir}" includes="**/*.*"/>
			<fileset dir="${src.dir}" includes="**/*.xq"/>
			<fileset dir="${src.dir}" includes="**/*.xml"/>			

			<manifest>
		    	<attribute name="Built-By" value="MXQuery Team at ETH Zurich (info@mxquery.org)"/>
		    	<attribute name="Main-Class" value="ch.ethz.mxquery.example.MXQuery"/>
		    </manifest>

		</jar>
	</target>
	
	<target name="noparser_copyfiles">
		<delete>
		    <fileset dir="${noparsertmp.dir}/">
		        <include name="**/*"/>
		    </fileset>
	    </delete>
		<mkdir dir="${noparsertmp.dir}"/>
		<copy todir="${noparsertmp.dir}"><fileset dir="${src.dir}"/></copy>
		<delete file="${noparsertmp.dir}/ch/ethz/mxquery/parser/parser.java"/>
		<delete file="${noparsertmp.dir}/ch/ethz/mxquery/example/MXQuery.java"/>
	</target>
	
	<target name="noparser_compile" depends="noparser_copyfiles">
		<echo message="Compiling..."/>
		
		<depend srcdir="${src.dir}"
		        destdir="${noparsertmp.dir}"
		        cache="depcache"
		        closure="yes"
		/>
	
	    <javac source="${src.version}"
	           srcdir="${noparsertmp.dir}"
	           destdir="${build.dir}"
	           classpathref="project.class.path"
	           debug="${debug}"
	           optimize="${optimize}"
	           extdirs=""
	    />
	</target>
	
	<target name="noparser_jar" depends="noparser_compile">
		<echo message="Creating jar archive without parser..."/>
		<unjar src="${resources.dir}/kxml2-min-2.3.0.jar" dest="${build.dir}"></unjar>
		<unjar src="${resources.dir}/xmlpull_1_1_3_4c.jar" dest="${build.dir}"></unjar>
		<jar jarfile="${dist.dir}/mxquery_noparser.jar">
	
			<fileset dir="${build.dir}" includes="**/*.*"/>
			<fileset dir="${src.dir}" includes="**/*.xq"/>
			<fileset dir="${src.dir}" includes="**/*.xml"/>			
	
			<manifest>
		    	<attribute name="Built-By" value="MXQuery Team at ETH Zurich (info@mxquery.org)"/>
		    	<attribute name="Main-Class" value="ch.ethz.mxquery.example.ExecutePlan"/>
		    </manifest>
	
		</jar>
	</target>

	<!-- ================================= 
          target: javadoc 
          creates Javadoc for MXQuery             
         ================================= -->
    <target name="javadoc">
        <javadoc author="no" access="public" 
        	sourcepath="${src.dir}"
        	destdir="${root.dir}/javadoc"
        	classpathref="project.class.path"
    	    doctitle="${officialName} ${version} API Documentation"
    	    bottom="${officialName} ${version} API Documentation - Copyright ${year} ${copyright}"
    	    header="${officialName} ${version} API Documentation - Copyright ${year} ${copyright}"
    	    footer="${officialName} ${version} API Documentation - Copyright ${year} ${copyright}"
        	>
        </javadoc>
    </target>

	
	<!-- ================================= 
          target: package-binary              
         ================================= -->
    <target name="package-binary" depends="">
        <zip destfile="mxquery-bin.zip">
        	<zipfileset dir="dist/" prefix="mxquery-bin/dist">
        		<include name="**/*.jar"/>
        		<include name="**/*.jad"/>
        		<include name="**/*.war"/>
        	</zipfileset>
        	<zipfileset dir="src/examples" prefix="mxquery-bin/examples">
        	</zipfileset>
        	<zipfileset dir="Documentation" prefix="mxquery-bin/Documentation">
        	</zipfileset>
        	<zipfileset dir="javadoc" prefix="mxquery-bin/Documentation/javadoc">
        	</zipfileset>
        	<zipfileset dir="." prefix="mxquery-bin/">
    		<include name="LICENSE"/>
        	<include name="NOTICE"/>
        	<include name="README"/>
			</zipfileset>

        </zip>
    </target>
	
	<!-- ================================= 
          target: package-source              
         ================================= -->
    <target name="package-source">
    	<zip destfile="mxquery-src.zip">
    		<zipfileset dir="src" prefix="mxquery-src/src"/>
    		<zipfileset dir="lib" prefix="mxquery-src/lib"/>
    		<zipfileset dir="altsrc" prefix="mxquery-src/altsrc"/>
    		<zipfileset dir="midp_src" prefix="mxquery-src/midp_src"/>
    		<zipfileset dir="customtmp" prefix="mxquery-src/customtmp">
    			<exclude name="**/*"/>
    		</zipfileset>
        	<zipfileset dir="mod2export" prefix="mxquery-src/mod2export"/>
    		<zipfileset dir="dist" prefix="mxquery-src/dist">
    			<exclude name="**/*"/>
    		</zipfileset>
    		<zipfileset dir="build" prefix="mxquery-src/build">
    			<exclude name="**/*"/>
    		</zipfileset>
    		<zipfileset dir="bin" prefix="mxquery-src/bin">
    			<exclude name="**/*"/>
    		</zipfileset>
        	<zipfileset dir="Documentation" prefix="mxquery-src/Documentation">
        	</zipfileset>
        	<zipfileset dir="javadoc" prefix="mxquery-src/Documentation/javadoc">
        	</zipfileset>
    		<zipfileset dir="." prefix="mxquery-src/">
    		    <include name="build.xml"/>
    			<include name="LICENSE"/>
    			<include name="README"/>
    			<include name="generate_funcgallery.xml"/>
            	<include name="NOTICE"/>
    			<include name=".project"/>
    			<include name=".classpath"/>
    		</zipfileset>
    	</zip>
    </target>
	
	
</project>
