<?xml version="1.0" ?>

<project default="build-common-target" basedir=".">
    
    <!-- Lib of the compiler jar -->
    <property name="lib.dir" value="ant/easysdi/common/lib" />
    <taskdef name="jscomp" classname="com.google.javascript.jscomp.ant.CompileTask" classpath="${lib.dir}/compiler.jar"/>
    
    <!-- 
        Create the administrator folder if necessary.
        Empty the administrator folder, except svn files.
        Copy the files from the Admin.
    --> 
    <target name="copy-administrator">
        <property name="src.out.dir" value="${root.out.dir}/${component.name}/src"/>
        <property name="package.out.dir" value="${root.out.dir}/${component.name}/target"/>
    
        <echo>Copy administrator structure of ${component.name} component</echo>
        <mkdir dir="${src.out.dir}/administrator" />
        <delete>
            <fileset dir="${src.out.dir}/administrator" includes="**/*"/>
        </delete>
        <copy todir="${src.out.dir}/administrator">
            <fileset dir="${joomla.administrator.components.dir}/${component.name}">
                <exclude name="easysdi_*.xml"/>
                <exclude name="script.*"/>
            </fileset>
        </copy>
        <echo>Copy administrator language file of ${component.name} component</echo>
        <copy todir="${src.out.dir}/administrator/language">
            <fileset dir="${joomla.administrator.language.dir}" includes="**/*${component.name}.ini"/>
        </copy>
        <echo>Copy administrator deployement xml file of ${component.name} component</echo>
        <copy todir="${src.out.dir}">
            <fileset dir="${joomla.administrator.components.dir}/${component.name}">
                <include name="easysdi_*.xml"/>
                <include name="script.*"/>
            </fileset>
        </copy>
    </target>
 
    <!-- 
        Create the site folder if necessary.
        Empty the site folder, except svn files.
        Copy the files from the site.
    --> 
    <target name="copy-site">
        <property name="src.out.dir" value="${root.out.dir}/${component.name}/src"/>
        <property name="package.out.dir" value="${root.out.dir}/${component.name}/target"/>
        
        <echo>Copy site structure of ${component.name} component</echo>
        <mkdir dir="${src.out.dir}/site" />
        <delete>
            <fileset dir="${src.out.dir}/site" includes="**/*"/>
        </delete>
        <copy todir="${src.out.dir}/site">
            <fileset dir="${joomla.site.components.dir}/${component.name}"/>
        </copy>
        <echo>Copy site language file of ${component.name} component</echo>
        <copy todir="${src.out.dir}/site/language">
            <fileset dir="${joomla.site.language.dir}" includes="**/*${component.name}.ini"/>
            <fileset dir="${joomla.site.language.dir}" includes="**/*${component.name}.sys.ini"/>
        </copy>
    </target>
    
    <!-- Create the build description file. --> 
    <target name="build-info">
        <property name="src.out.dir" value="${root.out.dir}/${component.name}/src"/>
        <echo>Create buid info file for ${component.name} component</echo>
        <mkdir dir="${src.out.dir}/META-INF"/>
        <tstamp>
            <format property="buildtime" pattern="dd.MM.yyyy hh:mm:ss aa" />
        </tstamp>
        <exec executable="svnversion" outputproperty="svnrevision">
            <arg line="${src.out.dir}"/>
        </exec>
        
        <propertyfile file="${src.out.dir}/META-INF/build-info.properties" comment="This file is automatically generated - DO NOT EDIT">
            <entry key="build-datetime" value="${buildtime}"/>
            <entry key="component" value="${component.name}"/>
            <entry key="build" value="${version}-r${svnrevision}"/>
            <entry key="build-owner" value="${user.name}"/>
        </propertyfile>
    </target>
    
    <!-- Compresses the component package. --> 
    <target name="zip-package">
        <property name="src.out.dir" value="${root.out.dir}/${component.name}/src"/>
        <property name="package.out.dir" value="${root.out.dir}/${component.name}/target"/>
        
        <echo>Zip package ${component.name}.zip</echo>
        <mkdir dir="${package.out.dir}"/>
        <delete>
            <fileset dir="${package.out.dir}" includes="*"/>
        </delete>
        <jar destfile="${package.out.dir}/${component.name}.zip">
            <fileset dir="${src.out.dir}"/>
        </jar>
    </target>
    
    
</project>