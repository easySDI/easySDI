
Ext.namespace("GeoExt.tree");GeoExt.tree.TristateCheckboxNode=Ext.extend(Ext.tree.TreeNode,{checkedChildNodes:null,checkedCount:null,constructor:function(config){this.checkedChildNodes={};this.checkedCount=0;this.defaultUI=this.defaultUI||GeoExt.tree.TristateCheckboxNodeUI;this.addEvents.apply(this,GeoExt.tree.TristateCheckboxNode.EVENT_TYPES);GeoExt.tree.TristateCheckboxNode.superclass.constructor.apply(this,arguments);this.on("childcheckchange",this.updateCheckedChildNodes,this);},render:function(bulkRender){var rendered=this.rendered;var checked=this.attributes.checked;this.attributes.checked=typeof this.attributes.checked=="undefined"?false:this.attributes.checked;GeoExt.tree.TristateCheckboxNode.superclass.render.call(this,bulkRender);var ui=this.getUI();if(!rendered){if(typeof checked=="undefined"&&this.parentNode.ui.checkbox){ui.toggleCheck(this.parentNode.ui.checkbox.checked);}
this.parentNode.on("checkchange",function(node,checked){ui.toggleCheck(checked);},this);}},updateCheckedChildNodes:function(node,checked){if(checked){this.addChecked(node,node.attributes.thirdState);}else{this.removeChecked(node);}
var childrenChecked,childrenThirdState;if(this.checkedCount.toFixed()==this.childNodes.length){childrenChecked=true;childrenThirdState=false;}else if(this.checkedCount.toFixed(1)==0){childrenChecked=false;childrenThirdState=false;}else{childrenChecked=true;childrenThirdState=true;}
this.getUI().toggleCheck(childrenChecked,childrenThirdState,{silent:true});if(this.parentNode){this.parentNode.fireEvent("childcheckchange",this,childrenChecked);}},appendChild:function(node){GeoExt.tree.TristateCheckboxNode.superclass.appendChild.call(this,node);if(this.attributes.checked||node.attributes.checked){this.addChecked(node);}
node.on("checkchange",function(node,checked){if(this.childrenRendered){this.fireEvent("childcheckchange",node,checked);}},this);},addChecked:function(node,thirdState){this.checkedCount-=(this.checkedChildNodes[node.id]||0);var add=thirdState?0.1:1;this.checkedChildNodes[node.id]=add;this.checkedCount+=add;},removeChecked:function(node){var remove=this.checkedChildNodes[node.id]
if(remove){delete this.checkedChildNodes[node.id];this.checkedCount-=remove;}}});GeoExt.tree.TristateCheckboxNode.EVENT_TYPES=["childcheckchange"];Ext.tree.TreePanel.nodeTypes.tristateCheckbox=GeoExt.tree.TristateCheckboxNode;