
Ext.state.Manager.setProvider(new Ext.state.CookieProvider());PrintGrid=function(filterString){var filter=this._convertToFilter(filterString);this.url=location.href.split('?')[0];this._readFeatureInfo();this.protocol=new OpenLayers.Protocol.WFS({url:componentParams.proxiedPubWfsUrl,featureNS:componentParams.pubFeatureNS,featurePrefix:componentParams.pubFeaturePrefix,featureType:this.usableFeatureType,geometryName:null,srsName:componentParams.projection,version:componentParams.pubWfsVersion,filter:filter,propertyNames:this.attrs,maxFeatures:componentParams.maxFeatures});this.protocol.read({callback:this._handleFeatures.createDelegate(this)});};PrintGrid.prototype._handleFeatures=function(response){var feature={},colIndex,catAndName;var table='<table>';table+='<thead><tr>';for(colIndex=0;colIndex<this.attrs.length;colIndex++){catAndName=EasySDI_Map.lang.getLocal('COL_'+this.attrs[colIndex]).split('/');table+='<th>'+catAndName[1]+'</th>';}
table+='</tr></thead><tbody>';for(var fIndex=0;fIndex<response.features.length;fIndex++){feature=response.features[fIndex];table+='<tr>';for(colIndex=0;colIndex<this.attrs.length;colIndex++){var value=feature.data[this.attrs[colIndex]];if(value==null)value='';table+='<td>'+value+'</td>';}
table+='</tr>';}
table+='</tbody></table>';var div=document.getElementById('printreport');div.innerHTML=table;};PrintGrid.prototype._convertToFilter=function(filterString){try
{xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async="false";xmlDoc.loadXML(filterString);}catch(e){parser=new DOMParser();xmlDoc=parser.parseFromString(filterString,"text/xml");}
var format=new OpenLayers.Format.Filter({version:"1.0.0"});var filter=format.read(xmlDoc.firstChild);return filter;};PrintGrid.prototype._readFeatureInfo=function(){this.usableFeatureType=featureType.replace('{geom}','');var visibleCols=Ext.state.Manager.get(this.usableFeatureType+'Cols',null);this.attrs=visibleCols;if(this.attrs==null){this.attrs=SData.defaultAttrs[this.usableFeatureType];}else{this.attrs=[];Ext.each(SData.attrs[this.usableFeatureType],function(attr){if(visibleCols.indexOf(attr.name)!=-1){this.attrs.push(attr.name);}},this);}}