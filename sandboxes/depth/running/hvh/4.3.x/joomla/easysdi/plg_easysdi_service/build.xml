<?xml version="1.0" ?>

<project default="plg_easysdi_service" basedir="../../../">
    
    <property name="service.plugin.name" value="plg_easysdi_service"/>
    <property name="service.plugin.language.file" value="plg_content_easysdiservice"/>
    <property name="plg.service.src.out.dir" value="${root.out.dir}/${service.plugin.name}/src"/>
    <property name="plg.service.package.out.dir" value="${root.out.dir}/${service.plugin.name}/target"/>
    <property name="joomla.service.plugin.path" value="content/easysdiservice"/>
    
    <available file="${joomla.plugin.path}/${joomla.service.plugin.path}" type="dir" property="service.plg.exist"/>
    
    <target name="package" depends="write-xml, build-info, plg_zip" description="Main target" />
    <target name="sync-package" depends="plg_copy, write-xml, build-info, plg_zip" description="Main target" if="${service.plg.exist}"/>
    <target name="sync" depends="plg_copy" description="Main target" />
    
    <target name="plg_copy">
        
        <echo>Copy plugin file for ${service.plugin.name}</echo>
       
        <copy todir="${plg.service.src.out.dir}" overwrite="true">
            <fileset dir="${joomla.plugin.path}/${joomla.service.plugin.path}" erroronmissingdir="false"/>
        </copy>
        <copy todir="${plg.service.src.out.dir}/language" overwrite="true">
            <fileset dir="${joomla.administrator.language.dir}" includes="**/*${service.plugin.language.file}.ini **/*${service.plugin.language.file}.sys.ini" erroronmissingdir="false"/>
        </copy>
    </target>
    
    <target name="write-xml">
        <echoxml file="${plg.service.src.out.dir}/easysdiservice.xml">
            <extension version="3.0" type="plugin" group="content" method="upgrade">
                <name>plg_easysdi_service</name>
                <author>EasySDI Community</author>
                <creationDate>${xml.releaseDate}</creationDate>
                <copyright>${xml.copyright}</copyright>
                <license>${xml.license}</license>
                <author>${xml.author}</author>
                <authorEmail>${xml.authorEmail}</authorEmail>
                <authorUrl>${xml.authorUrl}</authorUrl>
                <version>${version}</version>
                <description>PLG_CONTENT_EASYSDI_XML_DESCRIPTION</description>
                <scriptfile>script.php</scriptfile>
                <files>
                    <filename plugin="easysdiservice">easysdiservice.php</filename>
                    <filename plugin="easysdiservice">script.php</filename>
                </files>
                <languages>
                    <language tag="en-GB">language/en-GB/en-GB.plg_content_easysdiservice.sys.ini</language>
                    <language tag="en-GB">language/en-GB/en-GB.plg_content_easysdiservice.ini</language>
                    <language tag="fr-FR">language/fr-FR/fr-FR.plg_content_easysdiservice.sys.ini</language>
                    <language tag="fr-FR">language/fr-FR/fr-FR.plg_content_easysdiservice.ini</language>
                    <language tag="de-DE">language/de-DE/de-DE.plg_content_easysdiservice.sys.ini</language>
                    <language tag="de-DE">language/de-DE/de-DE.plg_content_easysdiservice.ini</language>
                </languages>
                <config>
                    <fields name="params">
                        <fieldset name="basic">
                            <field name="displaymessageinapplication" type="list"
                       default="both"
                       description="PLG_CONTENT_EASYSDI_DISPLAY_MESSAGE_DESC"
                       label="PLG_CONTENT_EASYSDI_DISPLAY_MESSAGE"
                            >
                                <option value="both">PLG_CONTENT_EASYSDI_DISPLAY_MESSAGE_BOTH</option>
                                <option value="fe">PLG_CONTENT_EASYSDI_DISPLAY_MESSAGE_FE</option>
                                <option value="be">PLG_CONTENT_EASYSDI_DISPLAY_MESSAGE_BE</option>
                                <option value="none">PLG_CONTENT_EASYSDI_DISPLAY_MESSAGE_NONE</option>
                            </field>
                        </fieldset>

                    </fields>
                </config> 
            </extension>
        </echoxml>
    </target>
    
    <!-- Create the build description file. --> 
    <target name="build-info">
        
        <echo>Create buid info file for ${service.plugin.name} plugin</echo>
        <mkdir dir="${plg.service.src.out.dir}/META-INF"/>
        <tstamp>
            <format property="buildtime" pattern="dd.MM.yyyy hh:mm:ss aa" />
        </tstamp>
        <exec executable="svnversion" outputproperty="svnrevision">
            <arg line="${plg.service.src.out.dir}"/>
        </exec>
        
        <propertyfile file="${plg.service.src.out.dir}/META-INF/build-info.properties" comment="This file is automatically generated - DO NOT EDIT">
            <entry key="build-datetime" value="${buildtime}"/>
            <entry key="plugin" value="${service.plugin.name}"/>
            <entry key="build" value="${version}-r${svnrevision}"/>
            <entry key="build-owner" value="${user.name}"/>
        </propertyfile>
    </target>
    
    <target name="plg_zip">
        
        <echo>Zip plugin package</echo>
        <jar destfile="${plg.service.package.out.dir}/${service.plugin.name}.zip">
            <fileset dir="${plg.service.src.out.dir}" excludes="site/**"/>
        </jar>
    </target>
   
</project>