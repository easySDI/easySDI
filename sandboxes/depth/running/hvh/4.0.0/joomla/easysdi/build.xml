<?xml version="1.0" ?>

<project default="easysdi" basedir="../">
    
    <!-- Global export path -->
    <property name="root.out.dir" value="easysdi" />
    <property name="parent.component.name" value="easysdi"/>
    <property name="parent.src.out.dir" value="${parent.component.name}/src"/>
    <property name="parent.package.out.dir" value="${parent.component.name}/target"/>
    <property name="version" value="4.0.0-alpha-3"/>
    
    <!-- Joomla component path -->
    <property name="joomla.administrator.components.dir" value="administrator/components" />
    <property name="joomla.administrator.language.dir" value="administrator/language" />
    <property name="joomla.site.components.dir" value="components" />
    <property name="joomla.site.language.dir" value="language" />
    <property name="joomla.template.dir" value="templates" />
    
    <!-- Joomla plugins path -->
    <property name="joomla.plugin.path" value="plugins"/>
    
    <!-- Java librairies path -->
    <property name="lib.path" value="easysdi/utils/lib"/>
    
    <!-- Joomla xml properties -->
    <property name="xml.packager" value="EasySDI Community"/>
    <tstamp>
        <format property="xml.releaseDate" pattern="dd MMMM yyyy"/>
    </tstamp>
    <property name="xml.copyright" value="Copyright (C) 2012. All rights reserved."/>
    <property name="xml.license" value="GNU General Public License version 3 or later; see LICENSE.txt"/>
    <property name="xml.author" value="EasySDI Community"/>
    <property name="xml.authorEmail" value="contact@easysdi.org"/>
    <property name="xml.authorUrl" value="http://www.easysdi.org"/>
    
    <taskdef name="jscomp" classname="com.google.javascript.jscomp.ant.CompileTask" classpath="${lib.path}/compiler.jar"/>
    <taskdef resource="net/sf/antcontrib/antcontrib.properties" classpath="${lib.path}/ant-contrib-1.0b3.jar"/>
    <taskdef resource="net/sf/antcontrib/antlib.xml" classpath="${lib.path}/ant-contrib-1.0b3.jar"/>
    <taskdef name="jsmin" classname="net.matthaynes.jsmin.JSMin_Task" classpath="${lib.path}/jsmin.0.2.4.jar"/>
    
    <!-- Import sub ant scripts -->
    <include file="com_easysdi_core/build.xml" as="core"/>
    <include file="com_easysdi_catalog/build.xml" as="catalog"/>
    <include file="com_easysdi_map/build.xml" as="map"/>
    <include file="com_easysdi_monitor/build.xml" as="monitor"/>
    <include file="com_easysdi_service/build.xml" as="service"/>
    <include file="com_easysdi_contact/build.xml" as="contact"/>
    <include file="com_easysdi_shop/build.xml" as="shop"/>
    <include file="plg_easysdi_monitor/build.xml" as="plg-monitor"/>
    <include file="plg_easysdi_contact/build.xml" as="plg-contact"/>
    <include file="plg_easysdi_service/build.xml" as="plg-service"/>
    <include file="tpl_easysdi/build.xml" as="tpl-easysdi"/>
    
    <!-- Packaging targets -->
    <target name="package-all" depends="package-com-core,package-com-catalog,package-com-map,package-com-monitor,package-com-service,package-com-contact,package-com-shop,package-plg-contact,package-plg-monitor,package-plg-service,package-tpl-easysdi,copy-sub-package,write-xml,package" description="Main target"/>
    
    <target name="package-com-core" depends="core.package" description="Main Target"/>
    <target name="package-com-catalog" depends="catalog.package" description="Main Target"/>
    <target name="package-com-map" depends="map.package" description="Main Target"/>
    <target name="package-com-monitor" depends="monitor.package" description="Main Target"/>
    <target name="package-com-service" depends="service.package" description="Main Target"/>
    <target name="package-com-shop" depends="shop.package" description="Main Target"/>
    <target name="package-com-contact" depends="contact.package" description="Main Target"/>
    
    <target name="package-plg-contact" depends="plg-contact.package" description="Main Target"/>
    <target name="package-plg-monitor" depends="plg-monitor.package" description="Main Target"/>
    <target name="package-plg-service" depends="plg-service.package" description="Main Target"/>
    
    <target name="package-tpl-easysdi" depends="tpl-easysdi.package" description="Main Target"/>
    
    <!-- Dev Packaging targets -->
    <target name="dev-package-all" depends="dev-package-com-core,dev-package-com-catalog,dev-package-com-map,dev-package-com-monitor,dev-package-com-service,dev-package-com-contact,dev-package-com-shop,package-plg-contact,package-plg-monitor,package-plg-service,copy-sub-package,write-xml,package" description="Main target"/>
    
    <target name="dev-package-com-core" depends="core.dev-package" description="Main Target"/>
    <target name="dev-package-com-catalog" depends="catalog.dev-package" description="Main Target"/>
    <target name="dev-package-com-map" depends="map.dev-package" description="Main Target"/>
    <target name="dev-package-com-monitor" depends="monitor.dev-package" description="Main Target"/>
    <target name="dev-package-com-service" depends="service.dev-package" description="Main Target"/>
    <target name="dev-package-com-shop" depends="shop.dev-package" description="Main Target"/>
    <target name="dev-package-com-contact" depends="contact.dev-package" description="Main Target"/>
    
    <target name="dev-package-tpl-easysdi" depends="tpl-easysdi.dev-package" description="Main Target"/>
    
    <!-- Sycronysing targets-->
    <target name="sync-all" depends="sync-com-core,sync-com-map,sync-com-monitor,sync-com-service,sync-com-contact,sync-com-shop,sync-plg-contact,sync-plg-monitor,sync-plg-service" description="Main target"/>
    
    <target name="sync-com-core" depends="core.sync" description="Main Target"/>
    <target name="sync-com-catalog" depends="catalog.sync" description="Main Target"/>
    <target name="sync-com-map" depends="map.sync" description="Main Target"/>
    <target name="sync-com-monitor" depends="monitor.sync" description="Main Target"/>
    <target name="sync-com-service" depends="service.sync" description="Main Target"/>
    <target name="sync-com-contact" depends="contact.sync" description="Main Target"/>
    <target name="sync-com-shop" depends="shop.sync" description="Main Target"/>
    
    <target name="sync-plg-contact" depends="plg-contact.sync" description="Main Target"/>
    <target name="sync-plg-monitor" depends="plg-monitor.sync" description="Main Target"/>
    <target name="sync-plg-service" depends="plg-service.sync" description="Main Target"/>
    
    <target name="sync-tpl-easysdi" depends="tpl-easysdi.sync" description="Main Target"/>
    
    <!-- Copy sub package in main package --> 
    <target name="copy-sub-package">
        <echo>Copy sub package</echo>
        <mkdir dir="${parent.src.out.dir}/easysdi" />
        <delete>
            <fileset dir="${parent.src.out.dir}/easysdi" includes="*"/>
        </delete>
        <copy todir="${parent.src.out.dir}/easysdi">
            <fileset dir="${root.out.dir}/com_easysdi_core/target" includes="*" erroronmissingdir="false"/>
            <fileset dir="${root.out.dir}/com_easysdi_catalog/target" includes="*" erroronmissingdir="false"/>
            <fileset dir="${root.out.dir}/com_easysdi_map/target" includes="*" erroronmissingdir="false"/>
            <fileset dir="${root.out.dir}/com_easysdi_monitor/target" includes="*" erroronmissingdir="false"/>
            <fileset dir="${root.out.dir}/com_easysdi_service/target" includes="*" erroronmissingdir="false"/>
            <fileset dir="${root.out.dir}/com_easysdi_contact/target" includes="*" erroronmissingdir="false"/>
            <fileset dir="${root.out.dir}/com_easysdi_shop/target" includes="*" erroronmissingdir="false"/>
            <fileset dir="${root.out.dir}/plg_easysdi_monitor/target" includes="*" erroronmissingdir="false"/>
            <fileset dir="${root.out.dir}/plg_easysdi_contact/target" includes="*" erroronmissingdir="false"/>
            <fileset dir="${root.out.dir}/plg_easysdi_service/target" includes="*" erroronmissingdir="false"/>
            <fileset dir="${root.out.dir}/tpl_easysdi/target" includes="*" erroronmissingdir="false"/>
        </copy>
    </target>
    
    <target name="write-xml">
        <echoxml file="${parent.src.out.dir}/pkg_easysdi.xml">
            <extension type="package" version="2.5" method="upgrade"> 
                <name>EasySDI</name> 
                <packager>${xml.packager}</packager> 
                <packagename>easysdi</packagename>
                <creationDate>15 August 2012</creationDate>
                <releaseDate>${xml.releaseDate}</releaseDate>
                <copyright>${xml.copyright}</copyright>
                <license>${xml.license}</license>
                <author>${xml.author}</author>
                <authorEmail>${xml.authorEmail}</authorEmail>
                <authorUrl>${xml.authorUrl}</authorUrl>
                <version>${version}</version>
                <description>PKG_EASYSDI_XML_DESCRIPTION</description> 
                <files folder="easysdi"> 
                    <file type="component" id="com_easysdi_core">com_easysdi_core.zip</file> 
                    <file type="component" id="com_easysdi_contact">com_easysdi_contact.zip</file>
                    <file type="component" id="com_easysdi_service">com_easysdi_service.zip</file>
                    <file type="component" id="com_easysdi_catalog">com_easysdi_catalog.zip</file> 
                    <file type="component" id="com_easysdi_map">com_easysdi_map.zip</file>
                    <file type="component" id="com_easysdi_shop">com_easysdi_map.zip</file>
                    <file type="plugin" id="easysdicontact" group="user">plg_easysdi_contact.zip</file> 
                    <file type="plugin" id="easysdiservice" group="content">plg_easysdi_service.zip</file>
                    <file type="template" id="tpl_easysdi" client="site">tpl_easysdi.zip</file>
                </files> 
                <languages>
                    <language tag="en-GB">language/en-GB/en-GB.pkg_easysdi.sys.ini</language>
                    <language tag="fr-FR">language/fr-FR/fr-FR.pkg_easysdi.sys.ini</language>
                </languages>
                <updateservers>
                    <server type="collection">http://update.easysdi.org/packages/easysdi/manifest.xml</server>
                </updateservers>
            </extension> 
        </echoxml>
    </target>
    
    <!-- Compress the complete package. --> 
    <target name="package">
        <echo>Zip full package</echo>
        <mkdir dir="${parent.package.out.dir}"/>
        <delete>
            <fileset dir="${parent.package.out.dir}" includes="*"/>
        </delete>
        <jar destfile="${parent.package.out.dir}/easysdi-${version}.zip">
            <fileset dir="${parent.src.out.dir}"/>
        </jar>
    </target>
    
</project>